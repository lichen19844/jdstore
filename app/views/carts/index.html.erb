<div class="cart__main__wapper">
  <div class="row">
    <div class="col-md-12">

      <%= link_to("清空购物车", clean_carts_path ,
                  method: :delete , class: "pull-right",
                  style: "text-decoration: underline;",
                  data: { confirm: "你确定要清空整个购物车吗？"} )%>

      <h2> 购物车 </h2>

      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="2">商品资讯</th>
            <th>单价</th>
            <th>数量</th>
            <th>操作选项 </th>
          </tr>
        </thead>
        <tbody>
          <div>
            <% current_cart.cart_items.each do |cart_item| %>
              <tr>
                <td>
                  <%= link_to product_path(cart_item.product) do %>
                    <% if cart_item.product.image.present? %>
                      <%= image_tag(cart_item.product.image.thumb.url, class: "thumbnail", style:"width:25%") %>
                    <% else %>
                      <%= image_tag("http://placehold.it/125x75&text=No Pic", class: "thumbnail") %>
                      <% end %>
                    <% end %>
                  </td>
                  <td>
                    <%= link_to(cart_item.product.title, product_path(cart_item.product)) %>
                  </td>
                  <td>
                    <%= cart_item.product.price %>
                  </td>
                  <td>
                    <% cart_item = current_cart.cart_items.find_by(product_id: cart_item.product_id) %>
                    <%= form_for cart_item, url: cart_item_path(cart_item.product_id) do |f| %>
                      <div class="input-group number-spinner">
                         <span class="input-group-btn">
                            <button class="btn btn-default" type="submit" name="sub" value="1"><span class="glyphicon glyphicon-minus"></span></button>
                         </span>
                         <%= f.number_field :quantity,class:"form-control text-center",:readonly => true  %>
                         <span class="input-group-btn">
                            <button class="btn btn-default" type="submit"  name="add" value="1"><span class="glyphicon glyphicon-plus"></span></button>
                         </span>
                      </div>
                    <% end %>
                  </td>

                  <td>
                    <%= link_to cart_item_path(cart_item.product_id), method: :delete do %>
                      <i class="fa fa-trash"></i>
                    <% end %>
                  </td>
                </tr>
              <% end %>
          </div>
        </tbody>
    </table>

      <br>

      <div class="total clearfix">
        <span class="pull-right">
          <span>
            总计 <%= render_cart_total_price(current_cart) %> RMB
          </span>
        </span>
      </div>

      <hr>

      <div class="checkout clearfix">
        <%= link_to("确认结账", checkout_carts_path, method: :post, class: "btn btn-lg btn-danger pull-right") %>
      </div>
    </div>
  </div>
</div>


<!-- 美洽客服 -->
<script type='text/javascript'>
    (function(m, ei, q, i, a, j, s) {
        m[i] = m[i] || function() {
            (m[i].a = m[i].a || []).push(arguments)
        };
        j = ei.createElement(q),
            s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = '//static.meiqia.com/dist/meiqia.js?_=t';
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '_MEIQIA');
    _MEIQIA('entId', 50521);
</script>
<script>
    // 你可以自己的代码中选择合适的时机来调用手动初始化
    _MEIQIA('init');
</script>
<!-- 美洽客服 -->
